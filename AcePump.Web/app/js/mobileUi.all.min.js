!function(){"use strict";angular.module("app.core",["ionic","ionic.native","ngFileUpload","ngCordova.plugins.nativeStorage"]),angular.module("app.core").value("$",angular.element).value("SignaturePad",SignaturePad)}(),function(){"use strict";function a(a){function b(a){return{request:function(b){return b.url=b.url.replace(d,a.apiUrl),b.url=b.url.replace(e,a.apiUrl+"auth/"),b}}}function c(a){return{request:function(b){return a.isLoggedIn&&d.test(b.url)&&(b.headers=b.headers||{},b.headers.Authorization="Bearer "+a.current.access_token),b}}}a.interceptors.push(c),a.interceptors.push(b);var d=/^\/api\//i,e=/^\/auth\//i;b.$inject=["environment"],c.$inject=["user"]}angular.module("app.core").config(a),a.$inject=["$httpProvider"]}(),function(){"use strict";function a(a,b,c){b.preloadComplete=!1,b.whenPreloadComplete=a.ready().then(function(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),c.loadCachedLogin()}).then(function(){b.preloadComplete=!0})}angular.module("app.core").run(a),a.$inject=["$ionicPlatform","$rootScope","user"]}(),function(){"use strict";function a(a,b){function c(a){return a.whenPreloadComplete}b.when("","/home").when("/","/home").otherwise("/home").deferIntercept(),a.state("top",{"abstract":!0,template:"<ion-nav-view></ion-nav-view>",resolve:{preload:c}}).state("top.login",{url:"/login",templateUrl:"core/login.html",controller:"LoginController as loginCtrl",cache:!1}).state("top.logout",{url:"/logout",controller:["$state","user",function(a,b){b.logout().then(function(){a.go("top.login")})}],cache:!1}),c.$inject=["$rootScope"]}angular.module("app.core").config(a),a.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function a(a,b,c,d,e){b.$on("$locationChangeSuccess",function(c,f,g){function h(){}var i={beforeSync:h,afterSync:h};d.isLoggedIn||(i.beforeSync=function(){return b.whenPreloadComplete}),i.beforeSync!==h&&(c.preventDefault(),a.when().then(i.beforeSync).then(function(){e.sync()}).then(i.afterSync))}),e.listen(),b.$on("$stateChangeStart",function(a,b,e,f){d.isLoggedIn||"top.login"===b.name||(a.preventDefault(),c.go("top.login",{},{location:!0}))})}angular.module("app.core").run(a),a.$inject=["$q","$rootScope","$state","user","$urlRouter"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){b.show({template:"Logging In..."}),e.login(g.username,g.password).then(function(){d.go("top.search")})["catch"](function(a){c.alert({title:"Login Failed",template:a})})["finally"](function(){b.hide()})}var g=this;g.subtitle=a.applicationSubtitle,g.login=f}angular.module("app.core").controller("LoginController",a),a.$inject=["environment","$ionicLoading","$ionicPopup","$state","user"]}(),function(){"use strict";angular.module("app.core").value("environment",window.environment)}(),function(){"use strict";function a(a,b,c,d){function e(){l.isLoggedIn=!1,l.current=null}function f(d,e){d||(d=""),e||(e="");var f=b.get("$http");return f.post("/auth/token","grant_type=password&username="+d+"&password="+e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(b){return l.current=b.data,l.isLoggedIn=!0,i(),a.setItem("current-user",l.current)})["catch"](function(a){return c.reject(a.data.error_description)})}function g(){l.isLoggedIn=!1,l.current=null;var c=b.get("$ionicHistory");return c.clearCache(),c.nextViewOptions({disableBack:!0}),j(),a.remove("current-user")}function h(){return a.getItem("current-user").then(function(a){l.current=a,l.isLoggedIn=!0,k()})["catch"](function(){return c.resolve()})}function i(){d.$broadcast("auth.login")}function j(){d.$broadcast("auth.logout")}function k(){d.$broadcast("auth.cacheload")}var l={login:f,logout:g,loadCachedLogin:h};return e(),l}angular.module("app.core").service("user",a),a.$inject=["$cordovaNativeStorage","$injector","$q","$rootScope"]}(),function(){"use strict";function a(a,b,c){function d(d,e,f){function g(){var c=b(f.acpApiSrc),e=c(d),g=a.apiUrl;return"/"===g.slice(-1)&&"/"===e.charAt(0)&&(g=g.slice(0,-1)),g+e}function h(a){if(a&&a.indexOf("/api/")>=0)return a+=a.indexOf("?")===-1?"?":"&",a+="oauth_qs_token="+c.current.access_token}var i=g();e.attr("src",h(i))}var e={link:d,restrict:"A"};return e}angular.module("app.core").directive("acpApiSrc",a),a.$inject=["environment","$parse","user"]}(),function(){"use strict";function a(a,b,c){function d(c,d,e){var f='<ion-modal-view ng-click="closeModal()" ><ion-content><img style="display:block; margin:auto" acp-api-src=\''+e.acpImgModalOnTap+"'  /></ion-content></ion-modal-view>";c.gridModal=b.fromTemplate(f,{scope:c,animation:"slide-in-up"}),c.closeModal=function(){c.gridModal.hide()},d.bind("click",function(){var b=a(c.gridModal.el).find("img");b[0].clientWidth>b[0].clientHeight?(b.css("width","100vw"),b.css("height","")):(b.css("width",""),b.css("height","100vh")),c.gridModal.show()})}var e={link:d,restrict:"A",scope:!0,priority:100};return e}angular.module("app.core").directive("acpImgModalOnTap",a),a.$inject=["$","$ionicModal","$parse"]}(),function(){"use strict";function a(a,b){function c(a,c,d,e){var f=new b(c.find("canvas")[0]);f.onEnd=function(a){var b=f.toDataURL().replace("data:image/png;base64,","");e.$setViewValue(b)},e.$render=function(a){a||f.isEmpty()||f.clear()},(d.required||d.ngRequired)&&e.$validators.required(function(a,b){return!b.length});var g=c[0];g.addEventListener("touchstart",function(a){a.preventDefault()},{passive:!1}),g.addEventListener("touchend",function(a){a.preventDefault()},{passive:!1}),g.addEventListener("touchmove",function(a){a.preventDefault()},{passive:!1})}var d={link:c,restrict:"E",require:"ngModel",template:'<canvas class="signature-pad"></canvas>'};return d}angular.module("app.core").directive("acpSignaturePad",a),a.$inject=["$","SignaturePad"]}(),function(){"use strict";function a(){function a(a,b,c){b.bind("keydown",function(a){var b=a.keyCode||a.which;if(13===b)for(var c=document.querySelectorAll("input, select, textarea, button"),d=a.srcElement||a.target,e=!1,f=c.length,g=0;g<f;g++){var h=c[g];if(e){if("submit"===h.type)break;if("none"!==h.style.display){a.preventDefault(),h.focus();break}}else h===d&&(e=!0)}})}var b={link:a,restrict:"A"};return b}angular.module("app.core").directive("acpFocusNextOnEnter",a),a.$inject=[]}(),function(){"use strict";function a(a,b,c){function d(d,e,f){function g(){var c=b(f.acpApiHref),e=c(d),g=a.apiUrl;return"/"===g.slice(-1)&&"/"===e.charAt(0)&&(g=g.slice(0,-1)),g+e}function h(a){if(a&&a.indexOf("/api/")>=0)return a+=a.indexOf("?")===-1?"?":"&",a+="oauth_qs_token="+c.current.access_token}var i=g();e.attr("href",h(i))}var e={link:d,restrict:"A"};return e}angular.module("app.core").directive("acpApiHref",a),a.$inject=["environment","$parse","user"]}(),function(){"use strict";function a(){return function(a){return(100*a).toFixed(3)+"%"}}angular.module("app.core").filter("percent",a),a.$inject=[]}(),function(){"use strict";angular.module("app.tickets",["app.core"])}(),function(){"use strict";function a(a,b){b.when("","/search").when("/","/search").otherwise("/search"),a.state("top.search",{url:"/search",cache:!1,templateUrl:"tickets/search.html",controller:"SearchController as searchCtrl"}).state("top.details",{url:"/details/{deliveryTicketId}",cache:!1,templateUrl:"tickets/details.html",controller:"DetailsController as detailsCtrl"}).state("top.viewPicture",{url:"/viewPicture",templateUrl:"tickets/viewPicture.html",controller:"ViewPictureController as viewPictureCtrl"}).state("top.takePicture",{url:"/takePicture/{deliveryTicketId}",cache:!1,templateUrl:"tickets/takePicture.html",controller:"TakePictureController as takePictureCtrl"}).state("top.signature",{url:"/signature/{deliveryTicketId}",cache:!1,templateUrl:"tickets/signature.html",controller:"SignatureController as signatureCtrl"})}angular.module("app.tickets").config(a),a.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";function a(a,b,c){function d(a){var b=h.get(a);return b}function e(a){return d(a)}function f(a,c){h.removeAll();var d="";return a?d="DeliveryTicketID eq "+a:d+="CloseTicket ne true",b({url:"/api/deliverytickets",method:"GET",params:{$top:c,$filter:d,$orderby:"DeliveryTicketID desc"}}).then(function(a){for(var b=0;b<a.data.length;b++)h.put(a.data[b].DeliveryTicketID,a.data[b]);return a.data})}var g={get:e,search:f},h=a("ticketsRepository");return g}angular.module("app.tickets").factory("ticketsRepository",a),a.$inject=["$cacheFactory","$http","$q"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(){i()}function i(){return b.show(),a({url:"/api/deliverytickets/"+p.currentTicket.DeliveryTicketID+"/images",method:"GET"}).then(function(a){p.images=a.data,b.hide()})}function j(a){return"/api/deliverytickets/"+a.DeliveryTicketID+"/smallImages/"+a.DeliveryTicketImageUploadID}function k(a){return"/api/deliverytickets/"+a.DeliveryTicketID+"/largeImages/"+a.DeliveryTicketImageUploadID}function l(d){return c.confirm({title:"Delete Image",template:"Are you sure you want to delete this image?"}).then(function(c){b.show(),c?a({url:"/api/deliverytickets/"+d.DeliveryTicketID+"/images/"+d.DeliveryTicketImageUploadID,method:"DELETE"}).then(function(a){var c=p.images.indexOf(d);p.images.splice(c,1),b.hide()}):b.hide()})["catch"](function(a){b.hide(),c.alert({title:"Delete Failed",template:a})})}function m(a){return e.currentImage=a,e.data={},c.show({title:"Please enter a note for this image",template:"<input type='text' ng-model='data.newNote' ng-value='currentImage.Note'></input>",scope:e,buttons:[{text:"Cancel",onTap:function(a){return!1}},{text:"<b>Save</b>",type:"button-positive",onTap:function(a){return e.data.newNote||!0}}]}).then(function(b){if(b&&a.Note!==e.data.newNote)return n(a,e.data.newNote)})["catch"](function(a){c.alert("Could not change note for this image. "+a)})}function n(c,d){return b.show(),a({url:"/api/deliverytickets/"+p.currentTicket.DeliveryTicketID+"/images/"+c.DeliveryTicketImageUploadID+"/Note",method:"PATCH",params:{note:d}}).then(function(a){b.hide(),c.Note=a.data.note})}function o(){return"/api/deliverytickets/"+p.currentTicket.DeliveryTicketID+"/pdf"}var p=this;p.currentTicket=g.get(f.deliveryTicketId),p.deleteImage=l,p.editNote=m,p.getSmallImageSrc=j,p.getLargeImageSrc=k,p.getPdfHref=o,h()}angular.module("app.tickets").controller("DetailsController",a),a.$inject=["$http","$ionicLoading","$ionicPopup","$q","$scope","$stateParams","ticketsRepository"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){h(null,10)}function g(){h(parseInt(i.searchID),10)}function h(b,c){a.show(),d.search(b,c).then(function(a){i.tickets=a})["catch"](function(a){e.alert(JSON.stringify(a))})["finally"](function(){a.hide()})}var i=this;i.runSearch=g,f()}angular.module("app.tickets").controller("SearchController",a),a.$inject=["$ionicLoading","$http","$q","ticketsRepository","$window"]}(),function(){"use strict";function a(){}angular.module("app.tickets").controller("ViewPictureController",a),a.$inject=[]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){o()}function o(){var a={quality:50,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,encodingType:Camera.EncodingType.JPEG};b.getPicture(a).then(function(a){r.imgData=a,r.imgURI="data:image/jpeg;base64,"+a;p(r.imgURI)},function(a){g.alert({title:"Camera Failure",template:a}).then(function(){e.goBack()})})}function p(b){var c=a("<div>").css({visibility:"hidden",position:"absolute"}).append(a("<img>").attr("src",b));document.body.append(c);var d=c[0].querySelector("img"),e={width:d.clientWidth,height:d.clientHeight};return c.remove(),e}function q(){f.show({template:'Uploading image <progress max="100" value="0" id="progress_bar_con"> </progress >'}).then(function(){return l.upload({url:"/api/deliverytickets/"+r.currentTicket.DeliveryTicketID+"/images",method:"PUT",data:{file:r.imgData}}).then(function(a){f.hide(),g.alert({title:"Upload Picture",template:"Upload was successful."}).then(function(){e.goBack()})},function(){f.hide(),g.alert({title:"Upload Picture",template:"Picture upload failed, please try again."}).then(function(){e.goBack()})},function(a){var b=parseInt(100*a.loaded/a.total);document.getElementById("progress_bar_con").value=b})})}var r=this;r.currentTicket=m.get(k.deliveryTicketId),r.takePicture=o,r.savePicture=q,n()}angular.module("app.tickets").controller("TakePictureController",a),a.$inject=["$","$cordovaCamera","$cordovaTransfer","$http","$ionicHistory","$ionicLoading","$ionicPopup","$q","$scope","$state","$stateParams","Upload","ticketsRepository"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){m(),n()}function j(){p.signatureForm.$setPristine(),p.signatureForm.$setUntouched()}function k(){return b.show(),a({url:"/api/deliverytickets/"+p.currentTicket.DeliveryTicketID+"/sign",method:"PATCH",data:p.signatureData}).then(function(a){p.currentTicket.HasSignature=!0,p.clearForm()})["finally"](function(){b.hide()})}function l(){p.signatureData.Signature=null,p.signatureData.SignatureName="",p.signatureData.SignatureCompanyName="",p.signatureData.SignatureDate=new Date,p.currentTicket.HasSignature=!1}function m(){return b.show(),p.signatureData={},a({url:"/api/deliverytickets/"+p.currentTicket.DeliveryTicketID+"/signatureData",method:"GET"}).then(function(a){p.signatureData=a.data,p.currentTicket.HasSignature=!!p.signatureData.Signature,p.currentTicket.HasSignature||(p.signatureData.SignatureDate=new Date)})["finally"](function(){b.hide()})}function n(){return b.show(),p.lineItems={},a({url:"/api/deliverytickets/"+p.currentTicket.DeliveryTicketID+"/lineItems",method:"GET"}).then(function(a){p.lineItems=a.data,p.signatureData.salesTotal=0,p.signatureData.taxOwed=0;for(var b=0;b<p.lineItems.length;b++)p.signatureData.salesTotal+=p.lineItems[b].LineTotal,p.signatureData.taxOwed+=p.lineItems[b].LineTotal*(p.lineItems[b].LineIsTaxable?p.signatureData.SalesTaxRate:0);p.signatureData.grandTotal=p.signatureData.salesTotal+p.signatureData.taxOwed})["finally"](function(){b.hide()})}function o(){c.backView().stateParams={deliveryTicketId:p.currentTicket.DeliveryTicketID},e.$ionicGoBack()}var p=this;p.currentTicket=h.get(g.deliveryTicketId),p.clearForm=j,p.saveSignature=k,p.resign=l,p.goBack=o,p.signatureForm={},p.signaturePad={},p.lineItems={},p.signatureData={},i()}angular.module("app.tickets").controller("SignatureController",a),a.$inject=["$http","$ionicLoading","$ionicHistory","$q","$rootScope","$scope","$stateParams","ticketsRepository"]}(),function(){"use strict";angular.module("app",["app.tickets"])}();